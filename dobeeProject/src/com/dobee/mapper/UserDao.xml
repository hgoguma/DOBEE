<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dobee.dao.UserDao">
	
	<!--  -->
	<select id="getUserList" resultType="com.dobee.vo.member.User">
		SELECT MAIL, NAME, MYPIC, AUTHCODE, TEAMCODE 
		FROM USER
	</select>
	
	<!-- User 정보 가져오기 -->
	<select id="getUser" resultType="com.dobee.vo.member.User">
		SELECT MAIL, PASSWORD, NAME, MYPIC, AUTHCODE FROM USER WHERE MAIL=#{mail}
	</select>
	
	
	<!-- UserInfo 정보가져오기 -->
	<select id="getUserInfoList" resultType="com.dobee.vo.member.UserInfo">
		SELECT MAIL, REGDATE, SERVE, EMP, POSITION, PHONE FROM USERINFO
	</select>
	
	
	<!-- Ajax 신청코드 불러오기 -->
	<select id="getApyCode" resultType="com.dobee.vo.ApplyCode">
		SELECT APYCODE, ENTRY FROM APPLYCODE
	</select>
	
		
	<!-- Ajax 결재자 불러오귀 // AUTHCODE=1 팀장 -->
	<select id="getApprovalList" resultType="com.dobee.vo.member.User">
		SELECT MAIL, NAME FROM USER WHERE AUTHCODE=1
	</select>
	
	
	<!-- Ajax 연장근무 년도 불러오기 -->
	<select id="overTimeYearList" resultType="Integer">
		SELECT DISTINCT DATE_FORMAT(ATTTIME, '%Y') FROM ATTEND
	</select>
	
	
	<!-- Ajax 연장근무 월 불러오기 -->
	<select id="overTimeMonthList" resultType="Integer">
		SELECT DISTINCT DATE_FORMAT(ATTTIME, '%c') FROM ATTEND;
	</select>
	
	
	<!-- 연장근무 신청하기 0112 -->
	<insert id="overTimeApply" parameterType="com.dobee.vo.Apply">
		INSERT INTO APPLY (REQDATE, REASON, STARTAT, ENDAT, ISAUTH, DRAFTER, APPROVAL, APYCODE)
			VALUES (CURDATE(), #{reason}, #{startAt}, #{endAt}, '미승인', #{drafter}, #{approval}, 6)
	</insert>
		
	
	<!-- 부재 신청하기 0112 -->
	<insert id="absApply" parameterType="com.dobee.vo.Apply">
		INSERT INTO APPLY (REQDATE, REASON, STARTAT, ENDAT, ISAUTH, DRAFTER, APPROVAL, APYCODE)
			VALUES (CURDATE(), #{reason}, #{startAt}, #{endAt}, '미승인', #{drafter}, #{approval}, #{apyCode})
	</insert>
	
	
	<!-- Ajax 연차 불러오기 0112 -->
	<select id="getVacationInBM" resultType="com.dobee.vo.member.Break">
		SELECT TOTALBREAK, USEDBREAK FROM BREAK WHERE MAIL='JG@KIM.COM'
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - Option - 년도 loading		0113 -->
	<select id="breakYearList" resultType="Integer">
		SELECT DISTINCT DATE_FORMAT(STARTAT, '%Y') FROM APPLY WHERE APYCODE != 6 AND  DRAFTER='JG@KIM.COM'
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - 년도별 List 출력		0113 -->
	<select id="getBreakListByYear" resultType="com.dobee.vo.member.BreakManageList">
		SELECT a.aplseq, AC.ENTRY, A.REQDATE, A.STARTAT, A.ENDAT, A.ISAUTH, A.APPROVAL, BL.USINGBREAK, A.REASON, A.REJREASON
			FROM APPLY A
				INNER JOIN APPLYCODE AC
					ON A.APYCODE = AC.APYCODE
				LEFT OUTER JOIN BREAKLIST BL
					ON A.APLSEQ = BL.APLSEQ
			WHERE  A.APYCODE != 6 AND A.DRAFTER='JG@KIM.COM' AND DATE_FORMAT(A.STARTAT, '%Y') = 2020;
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - Option - 월 loading		0113 -->
	<select id="breakYearMonthList" resultType="String">
		SELECT DISTINCT DATE_FORMAT(STARTAT, '%Y-%m') AS STARTAT FROM APPLY WHERE APYCODE != 6 AND  DRAFTER='JG@KIM.COM'
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - 년-월별 List 출력		0113 -->
	<select id="getBreakListByYMonth" resultType="com.dobee.vo.member.BreakManageList">
		SELECT a.aplseq, AC.ENTRY, A.REQDATE, A.STARTAT, A.ENDAT, A.ISAUTH, A.APPROVAL, BL.USINGBREAK, A.REASON, A.REJREASON
			FROM APPLY A	
				INNER JOIN APPLYCODE AC
					ON A.APYCODE = AC.APYCODE
				LEFT OUTER JOIN BREAKLIST BL
					ON A.APLSEQ = BL.APLSEQ
			WHERE  A.APYCODE != 6 AND A.DRAFTER='JG@KIM.COM' AND DATE_FORMAT(A.STARTAT, '%Y-%m') = '2020-01';
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - Option - 부재항목 loading		0113 -->
	<select id="breakEntryList" resultType="com.dobee.vo.ApplyCode">
		SELECT DISTINCT AC.APYCODE, AC.ENTRY 
			FROM APPLY A
				INNER JOIN APPLYCODE AC
	        		ON A.APYCODE = AC.APYCODE
			WHERE A.APYCODE != 6 AND  A.DRAFTER='JG@KIM.COM'
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - 부재항목 별 List 출력		0113 -->
	<select id="getBreakListByEntry" resultType="com.dobee.vo.member.BreakManageList">
		SELECT a.aplseq, AC.ENTRY, A.REQDATE, A.STARTAT, A.ENDAT, A.ISAUTH, A.APPROVAL, BL.USINGBREAK, A.REASON, A.REJREASON
			FROM APPLY A
				INNER JOIN APPLYCODE AC
					ON A.APYCODE = AC.APYCODE
				LEFT OUTER JOIN BREAKLIST BL
					ON A.APLSEQ = BL.APLSEQ
			WHERE  A.DRAFTER='JG@KIM.COM' AND A.APYCODE = '2';
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - Option - 승인여부 loading		0113 -->
	<select id="breakIsAuthList" resultType="String">
		SELECT DISTINCT ISAUTH FROM APPLY WHERE APYCODE != 6 AND  DRAFTER='JG@KIM.COM'
	</select>
	
	
	<!-- Ajax 개인부재일정확인 - 승인여부 별  List 출력		0113 -->
	<select id="getBreakListByIsAuth" resultType="com.dobee.vo.member.BreakManageList">
		SELECT a.aplseq, AC.ENTRY, A.REQDATE, A.STARTAT, A.ENDAT, A.ISAUTH, A.APPROVAL, BL.USINGBREAK, A.REASON, A.REJREASON
			FROM APPLY A
				INNER JOIN APPLYCODE AC
					ON A.APYCODE = AC.APYCODE
				LEFT OUTER JOIN BREAKLIST BL
					ON A.APLSEQ = BL.APLSEQ
			WHERE  A.APYCODE != 6 AND A.DRAFTER='JG@KIM.COM' AND A.ISAUTH = '미승인';
	</select>
	
	
	<!-- 부재내역 불러오기 -->
	<select id="absMg" resultType="com.dobee.vo.member.BreakManageList">
		SELECT A.APLSEQ, AC.ENTRY, A.REQDATE, A.STARTAT, A.ENDAT, A.ISAUTH, A.APPROVAL, BL.USINGBREAK, A.REASON, A.REJREASON
			FROM APPLY A
			    INNER JOIN APPLYCODE AC
					ON A.APYCODE = AC.APYCODE
				LEFT OUTER JOIN BREAKLIST BL
					ON A.APLSEQ = BL.APLSEQ
		    WHERE A.APYCODE != 6 AND A.DRAFTER = 'JG@KIM.COM'
	</select>
	
	
	<!-- 권한목록 불러오기 -->
	<select id="getAuthority" resultType="com.dobee.vo.member.Authority">
		SELECT AUTH, AUTHCODE FROM AUTHORITY
	</select>
	
	
	<!-- 팀목록 불러오기 -->
	<select id="getTeamList" resultType="com.dobee.vo.member.TeamList">
		SELECT TEAMCODE, TEAMNAME FROM TEAMLIST
	</select>
</mapper>